# 总线

By: [:material-github: howardlau1999](https://github.com/howardlau1999)

## 简介

CPU 和其他设备如果想要通信，那么就要和其他设备在物理上连接起来。如果每个设备都像内存一样，需要修改 CPU 的设计和 IO 端口才能连接，那么假如有 m 种 CPU 和 n 种外设，复杂度将成为 O(mn)，不仅每个 CPU 都要适配所有的外设，而且还要把所有的外设都适配到所有 CPU 上，这样的复杂度是不现实的，同时也不灵活。这时，我们就得想到计算机科学的一条“金科玉律”：

> Any problem in computer science can be solved with another level of indirection. [^1]

[^1]: <http://bwlampson.site/Slides/TuringLecture.htm>

既然直接连接起来不现实，那么我们就通过引入一个通用的中间层，让大家都连接到这个中间层，不就把复杂度变为 O(m + n) 了吗？人们觉得这个想法不错，并给这种技术起了一个形象的名字：总线（Bus）。正如它的英文所展示的一样，数据不再是直接在 CPU 和外设间传递，而是先搭上总线这个“公交车”，到达目的地之后再“下车”。

当然，任何的额外的间接层都是有代价的，引入总线有两个问题需要解决：

1. 数据怎么知道它的目的地是哪里？
2. 好几个设备都想同时发送数据，然而总线只允许一个设备发送，要如何仲裁？

而且，作为一层通信协议，各家设备厂商都想设计一套最适合自己设备的协议，于是，总线协议也是百花齐放，有 PCI-e、I2C、USB、AXI 等等……不同总线协议也有不同的使用场景，应当支持哪些协议也是一个需要权衡的问题。

## 握手

## 仲裁