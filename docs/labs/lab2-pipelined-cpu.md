# 流水线 CPU

在完成单周期 CPU 实验后，你已经对 CPU 的原理和结构已经有了基本的了解。但单周期的 CPU 设计中，关键路径太长，频率难以提升。

在本实验中，你将学习到：

- 使用三级流水线设计缩短关键路径
- 正确处理流水线阻塞与清空
- 使用转发逻辑减少流水线阻塞

## 流水线寄存器

## 流水线清空

## 流水线阻塞

## 扩展实验

### 五级流水线设计

在三级流水线中，执行阶段逻辑复杂，仍然可能导致较大的延迟。为了进一步缩短关键路径，我们可以扩展流水线级数，将执行阶段进一步分为 ALU 阶段、访存阶段以及写回阶段。

在五级流水线中，由于写回阶段在靠后的位置，有可能一个指令的源操作数在 ALU 阶段时还没有写回。这种情况下，会产生数据竞争。一种解决数据竞争的方法是直接阻塞流水线，这种方法实现简单，延迟较低，但是会产生流水线气泡，降低执行效率。另一种减少流水线气泡的方法是使用转发逻辑，将写回阶段或访存阶段的结果转发给 ALU 单元。使用转发逻辑的设计虽然能减少流水线气泡，但是会使得电路变得更复杂，能耗上升，可能会对时钟频率产生一定影响。